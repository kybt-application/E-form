<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form ‡πÄ‡∏ä‡∏¥‡∏ç‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 3 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</title>
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body {
    font-family: 'Inter', sans-serif;
    background: #f0f2f5;
}
.container {
    max-width: 900px;
    margin: 40px auto;
    padding: 30px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}
h2, h3 {
    text-align: center;
    font-weight: 600;
    color: #333;
}
.employee-card {
    margin-bottom: 20px;
    border-radius: 12px;
    border: 1px solid #e0e0e0;
    padding: 20px;
    background: #fafafa;
}
button {
    border-radius: 8px;
}
.logo {
    display: block;
    margin: 0 auto 20px;
    width: 300px;
}
.agenda-card {
    background: #fafafa;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    padding: 20px;
}
.step {
    display: none;
}
.step.active {
    display: block;
}
</style>
</head>
<body style="background-image: url('b1.jpg'); background-size: cover; background-position: unset;background-attachment:fixed">
<div class="container">

    <!-- STEP 1: ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏ä‡∏¥‡∏ç -->
    <div id="step1" class="step active">
        <img src="logo.jpg" alt="Logo" class="logo">
        <h2>‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° Supplier Annual Meeting 2025</h2>
        <div class="agenda-card mt-4">
            <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</h5>
            <p><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:</strong> 15 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2025 ‡πÄ‡∏ß‡∏•‡∏≤ 09.00 ‡∏ô.</p>
            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà</p>
            <p><strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å:</strong> ‡∏£‡πà‡∏ß‡∏°‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÉ‡∏ô‡∏õ‡∏µ 2026</p>
        </div>
        <div class="text-center mt-4">
            <button id="nextToStep2" class="btn btn-primary  btn-lg">Next</button>
        </div>
    </div>

    <!-- STEP 2: ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div id="step2" class="step">
        <h2>‡πÄ‡∏ä‡∏¥‡∏ç‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h2>
        <form id="inviteForm">
            <div class="mb-3">
                <label class="form-label">Supplier:</label>
                <span id="supplierName" class="fw-bold"></span>
            </div>
            <div id="employeeList"></div>
            <div class="d-flex justify-content-between mt-4">
                <button type="button" id="backToStep1" class="btn btn-secondary btn-lg">back</button>
                <button type="submit" class="btn btn-primary btn-lg">Submit</button>
            </div>
        </form>
    </div>

    <!-- STEP 3: ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à -->
    <div id="step3" class="step text-center">
        <img src="logo.jpg" alt="Logo" class="logo">
        <h2 class="text-success">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô üéâ</h2>
        <p>‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
        <div class="agenda-card mt-4 text-start">
            <h5>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</h5>
            <p><strong>‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤:</strong> 15 ‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô 2025 ‡πÄ‡∏ß‡∏•‡∏≤ 09.00 ‡∏ô.</p>
            <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏ç‡πà ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà</p>
            <p><strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å:</strong> ‡∏£‡πà‡∏ß‡∏°‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡πÉ‡∏ô‡∏õ‡∏µ 2026</p>
        </div>
    </div>

</div>

<script>
// ‡∏≠‡πà‡∏≤‡∏ô supplier ‡πÅ‡∏•‡∏∞ token ‡∏à‡∏≤‡∏Å URL
const urlParams = new URLSearchParams(window.location.search);
const supplier = urlParams.get('supplier') || '';
const token = urlParams.get('token') || '';
document.getElementById('supplierName').textContent = supplier;

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô step
function showStep(step) {
    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.getElementById(step).classList.add('active');
}

// ‡πÑ‡∏õ Step 2
document.getElementById('nextToStep2').addEventListener('click', () => {
    showStep('step2');
});

// ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö Step 1
document.getElementById('backToStep1').addEventListener('click', () => {
    showStep('step1');
});

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
async function loadEmployees() {
    try {
        const res = await fetch(`https://kybt-systems.com/Authentication/api/get_employees?supplier=${encodeURIComponent(supplier)}&token=${encodeURIComponent(token)}`);
        const employees = await res.json();
        const container = document.getElementById('employeeList');
        container.innerHTML = '';

        if(employees.error){
            container.innerHTML = `<p class="text-danger">${employees.error}</p>`;
            return;
        }

        employees.forEach(emp => {
            const div = document.createElement('div');
            div.className = 'employee-card';
            div.innerHTML = `
                <p class="h5 fw-semibold">${emp.employee_name}</p>
                <div class="mb-3">
                    <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                    <select name="status_${emp.id}" class="form-select" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                        <option value="OK">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</option>
                        <option value="substitute">‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏ó‡∏ô</option>
                        <option value="not">‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</option>
                    </select>
                </div>
                <div class="extraFields"></div>
            `;
            container.appendChild(div);

            const select = div.querySelector('select');
            const extraFields = div.querySelector('.extraFields');

            select.addEventListener('change', () => {
                const status = select.value;
                if(status === 'OK'){ // ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
                    extraFields.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
                            <input type="email" name="email_${emp.id}" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
                        </div>
                    `;
                } else if(status === 'substitute'){ // ‡∏°‡∏µ‡∏Ñ‡∏ô‡πÅ‡∏ó‡∏ô
                    extraFields.innerHTML = `
                        <div class="mb-3">
                            <label class="form-label">‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤:</label>
                            <input type="text" name="prefix_${emp.id}" class="form-control" placeholder="‡∏ô‡∏≤‡∏¢/‡∏ô‡∏≤‡∏á/‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠:</label>
                            <input type="text" name="first_name_${emp.id}" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</label>
                            <input type="text" name="last_name_${emp.id}" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</label>
                            <input type="email" name="email_${emp.id}" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•" required>
                        </div>
                    `;
                } else {
                    extraFields.innerHTML = '';
                }
            });
        });
    } catch (error) {
        console.error(error);
        Swal.fire({
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ üò¢',
            icon: 'error',
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
        });
    }
}

// ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ backend
document.getElementById('inviteForm').addEventListener('submit', async e => {
    e.preventDefault();
    const form = e.target;
    if(!form.checkValidity()){
        form.reportValidity();
        return;
    }

    const formData = new FormData();
    formData.append('supplier', supplier);
    formData.append('token', token);

    document.querySelectorAll('.employee-card').forEach(card => {
        const empId = card.querySelector('select').name.split('_')[1];
        const status = card.querySelector('select').value;
        formData.append(`status_${empId}`, status);
        card.querySelectorAll('input').forEach(input => formData.append(input.name, input.value));
    });

    try {
        const res = await fetch('https://kybt-systems.com/Authentication/api/save_invite', {
            method: 'POST',
            body: formData
        });
        const result = await res.json();

        if(result.status === 'ok') {
            showStep('step3');
        } else {
            Swal.fire({
                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                text: result.message || '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏',
                icon: 'error',
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }
    } catch (err) {
        console.error(err);
        Swal.fire({
            title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
            text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ üò¢',
            icon: 'error',
            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
        });
    }
});

loadEmployees();
</script>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
